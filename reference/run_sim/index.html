
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../helpers/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.48">
    
    
      
        <title>run_sim - Simulate Test Cases</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../styles/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#run_sim_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Simulate Test Cases" class="md-header__button md-logo" aria-label="Simulate Test Cases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Simulate Test Cases
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              run_sim
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/introduction/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../helpers/" class="md-tabs__link">
          
  
  Source Overview

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../additionalInfo/" class="md-tabs__link">
        
  
    
  
  Additional Information

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Simulate Test Cases" class="md-nav__button md-logo" aria-label="Simulate Test Cases" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Simulate Test Cases
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/inputs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/outputs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    outputs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Source Overview
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Source Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    run_sim
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    run_sim
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#run_sim" class="md-nav__link">
    <span class="md-ellipsis">
      run_sim
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run_sim.Top" class="md-nav__link">
    <span class="md-ellipsis">
      Top
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Top">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run_sim.Top--methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.Top--inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.Top--outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run_sim.run_sim" class="md-nav__link">
    <span class="md-ellipsis">
      run_sim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_sim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim--methods" class="md-nav__link">
    <span class="md-ellipsis">
      Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim--inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.post_process" class="md-nav__link">
    <span class="md-ellipsis">
      post_process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="post_process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.post_process--outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.post_process--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.run--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.run_problem" class="md-nav__link">
    <span class="md-ellipsis">
      run_problem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_problem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.run_problem--outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run_sim.run_sim.run_problem--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../additionalInfo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional Information
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="run_sim_1">run_sim</h1>


<div class="doc doc-object doc-module">



<a id="run_sim"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="run_sim.Top" class="doc doc-heading">
            <code>Top</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="mphys.multipoint.Multipoint">Multipoint</span></code></p>


        <p>Sets up an OpenMDAO problem using MPhys and ADflow for aerodynamic simulations.</p>
<p>This class is designed to integrate OpenMDAO with MPhys and ADflow to perform aerodynamic simulations. It sets up the problem environment, manages inputs and outputs, and configures scenarios for simulation.</p>
<h4 id="run_sim.Top--methods">Methods</h4>
<p><strong>setup()</strong>
    Initializes and sets up the required subsystems and scenarios.</p>
<p><strong>configure()</strong>
    Configures the aerodynamic problem (e.g., reference area, chord, angle of attack) and connects design variables to the system.</p>
<h4 id="run_sim.Top--inputs">Inputs</h4>
<ul>
<li><strong>case_info</strong> : dict
    Dictionary containing geometry and configuration details for the case being analyzed.</li>
<li><strong>exp_info</strong> : dict
    Dictionary with experimental conditions such as Mach number, Reynolds number, and temperature.</li>
<li><strong>aero_options</strong> : dict
    ADflow solver parameters that control aerodynamic analysis.</li>
</ul>
<h4 id="run_sim.Top--outputs">Outputs</h4>
<p>None. This class directly modifies the OpenMDAO problem structure to include aerodynamic analysis subsystems.</p>






              <details class="quote">
                <summary>Source code in <code>simulateTestCases/run_sim.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="k">class</span> <span class="nc">Top</span><span class="p">(</span><span class="n">Multipoint</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Sets up an OpenMDAO problem using MPhys and ADflow for aerodynamic simulations.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    This class is designed to integrate OpenMDAO with MPhys and ADflow to perform aerodynamic simulations. It sets up the problem environment, manages inputs and outputs, and configures scenarios for simulation.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Methods</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    --------</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    **setup()**</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        Initializes and sets up the required subsystems and scenarios.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    **configure()**</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        Configures the aerodynamic problem (e.g., reference area, chord, angle of attack) and connects design variables to the system.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Inputs</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    -------</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    - **case_info** : dict</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Dictionary containing geometry and configuration details for the case being analyzed.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    - **exp_info** : dict</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Dictionary with experimental conditions such as Mach number, Reynolds number, and temperature.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    - **aero_options** : dict</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        ADflow solver parameters that control aerodynamic analysis.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    Outputs</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    --------</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    None. This class directly modifies the OpenMDAO problem structure to include aerodynamic analysis subsystems.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case_info</span><span class="p">,</span> <span class="n">exp_info</span><span class="p">,</span> <span class="n">aero_options</span><span class="p">):</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">case_info</span> <span class="o">=</span> <span class="n">case_info</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exp_info</span> <span class="o">=</span> <span class="n">exp_info</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aero_options</span> <span class="o">=</span> <span class="n">aero_options</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">adflow_builder</span> <span class="o">=</span> <span class="n">ADflowBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aero_options</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="s2">&quot;aerodynamic&quot;</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">adflow_builder</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">adflow_builder</span><span class="o">.</span><span class="n">err_on_convergence_fail</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="c1">################################################################################</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="c1"># MPHY setup</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1">################################################################################</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="c1"># ivc to keep the top level DVs</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;dvs&quot;</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">(),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># create the mesh and cruise scenario because we only have one analysis point</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;mesh&quot;</span><span class="p">,</span> <span class="n">adflow_builder</span><span class="o">.</span><span class="n">get_mesh_coordinate_subsystem</span><span class="p">())</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mphys_add_scenario</span><span class="p">(</span><span class="s2">&quot;cruise&quot;</span><span class="p">,</span> <span class="n">ScenarioAerodynamic</span><span class="p">(</span><span class="n">aero_builder</span><span class="o">=</span><span class="n">adflow_builder</span><span class="p">))</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;mesh.x_aero0&quot;</span><span class="p">,</span> <span class="s2">&quot;cruise.x_aero&quot;</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">aoa</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># Set default Angle of attack</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">geometry_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;geometry_info&#39;</span><span class="p">]</span> <span class="c1"># Load geometry info</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">chordRef</span> <span class="o">=</span> <span class="n">geometry_info</span><span class="p">[</span><span class="s1">&#39;chordRef&#39;</span><span class="p">]</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">areaRef</span> <span class="o">=</span> <span class="n">geometry_info</span><span class="p">[</span><span class="s1">&#39;areaRef&#39;</span><span class="p">]</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">ap0</span> <span class="o">=</span> <span class="n">AeroProblem</span><span class="p">(</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ap0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="c1"># Experimental Conditions </span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">mach</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;mach&#39;</span><span class="p">],</span> <span class="n">reynolds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;Re&#39;</span><span class="p">],</span> <span class="n">reynoldsLength</span><span class="o">=</span><span class="n">chordRef</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">],</span> 
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">aoa</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="c1"># Geometry Info</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">areaRef</span><span class="o">=</span><span class="n">areaRef</span><span class="p">,</span> 
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">chordRef</span><span class="o">=</span><span class="n">chordRef</span><span class="p">,</span> 
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">evalFuncs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cl&quot;</span><span class="p">,</span> <span class="s2">&quot;cd&quot;</span><span class="p">]</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">ap0</span><span class="o">.</span><span class="n">addDV</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">aoa</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;aoa&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="c1"># set the aero problem in the coupling and post coupling groups</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cruise</span><span class="o">.</span><span class="n">coupling</span><span class="o">.</span><span class="n">mphys_set_ap</span><span class="p">(</span><span class="n">ap0</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cruise</span><span class="o">.</span><span class="n">aero_post</span><span class="o">.</span><span class="n">mphys_set_ap</span><span class="p">(</span><span class="n">ap0</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="c1"># add dvs to ivc and connect</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dvs</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;aoa&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">aoa</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;aoa&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cruise.coupling.aoa&quot;</span><span class="p">,</span> <span class="s2">&quot;cruise.aero_post.aoa&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="run_sim.run_sim" class="doc doc-heading">
            <code>run_sim</code>


</h2>


    <div class="doc doc-contents ">


        <p>Executes ADflow simulations using the <code>Top</code> class.</p>
<p>This class sets up, runs, and post-processes aerodynamic simulations based on input parameters provided via a YAML configuration file. It validates the input, manages directories, and handles outputs, including plots and summary files.</p>
<h4 id="run_sim.run_sim--methods">Methods</h4>
<p><strong>run_problem()</strong>
    Sets up and runs the OpenMDAO problem for all cases, hierarchies, and refinement levels.</p>
<p><strong>run()</strong>
    Executes the simulation on either a local machine or an HPC system.</p>
<p><strong>post_process()</strong>
    Generates plots comparing experimental data (if available) with ADflow simulation results.</p>
<h4 id="run_sim.run_sim--inputs">Inputs</h4>
<ul>
<li><strong>info_file</strong> : str
    Path to the YAML file containing simulation configuration and information.</li>
</ul>






              <details class="quote">
                <summary>Source code in <code>simulateTestCases/run_sim.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="k">class</span> <span class="nc">run_sim</span><span class="p">():</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Executes ADflow simulations using the `Top` class.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    This class sets up, runs, and post-processes aerodynamic simulations based on input parameters provided via a YAML configuration file. It validates the input, manages directories, and handles outputs, including plots and summary files.</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    Methods</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    -------</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    **run_problem()**</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        Sets up and runs the OpenMDAO problem for all cases, hierarchies, and refinement levels.</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    **run()**</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Executes the simulation on either a local machine or an HPC system.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    **post_process()**</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        Generates plots comparing experimental data (if available) with ADflow simulation results.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    Inputs</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    - **info_file** : str</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        Path to the YAML file containing simulation configuration and information.</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_file</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="c1"># Validate the input yaml file</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">check_input_yaml</span><span class="p">(</span><span class="n">info_file</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;YAML file validation is successful&quot;</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">info_file</span> <span class="o">=</span> <span class="n">info_file</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_file</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">[</span><span class="s1">&#39;out_dir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">final_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/overall_sim_info.yaml&quot;</span> <span class="c1"># Setting the overall simulation info file.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="c1"># Create the output directory if it doesn&#39;t exist</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">):</span> 
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1">################################################################################</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="c1"># Code for running simulations</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="c1">################################################################################   </span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">def</span> <span class="nf">run_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Sets up and runs the OpenMDAO problem for aerodynamic simulations.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        This method iterates through all hierarchies, cases, refinement levels, and angles of attack defined in the input YAML file. For each combination, it sets up the OpenMDAO problem, runs the simulation, and stores the results.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        Outputs</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        -------</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        - **A CSV file**:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">            Contains results for each angle of attack at the current refinement level.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        - **A YAML file**:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">            Stores simulation data for each angle of attack in the corresponding directory.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        - **A final YAML file**:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">            Summarizes all simulation results across hierarchies, cases, and refinement levels.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        -----</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        This method ensures that:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        - Existing successful simulations are skipped.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        - Directories are created dynamically if they do not exist.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        - Simulation results are saved in structured output files.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="c1"># Store a copy of input YAML file in output directory</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">input_yaml_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/input_file.yaml&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_yaml_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_yaml_handle</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">,</span> <span class="n">input_yaml_handle</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">sim_info_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">)</span> <span class="c1"># Copying to run the loop</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">sim_out_info</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">)</span> <span class="c1"># Copying to write the output YAML file</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">start_wall_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="k">for</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">hierarchy_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hierarchies&#39;</span><span class="p">]):</span> <span class="c1"># loop for Hierarchy level</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">for</span> <span class="n">case</span><span class="p">,</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;cases&#39;</span><span class="p">]):</span> <span class="c1"># loop for cases in hierarchy</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">aero_options</span> <span class="o">=</span> <span class="n">default_aero_options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">aero_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;solver_parameters&#39;</span><span class="p">])</span> <span class="c1"># Update ADflow solver parameters</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="k">for</span> <span class="n">exp_set</span><span class="p">,</span> <span class="n">exp_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;exp_sets&#39;</span><span class="p">]):</span> <span class="c1"># loop for experimental datasets that may present</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;SIMULATION INFO&#39;</span><span class="si">:</span><span class="s2">^30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Hierarchy&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Case Name&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Experimental Condition&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exp_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Reynolds Number (Re)&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;Re&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Mach Number&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;mach&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                    <span class="c1"># Extract the Angle of attacks for which the simulation has to be run</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                    <span class="n">aoa_list</span> <span class="o">=</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;aoa_list&#39;</span><span class="p">]</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                    <span class="n">exp_sim_info</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Creating experimental level sim info dictionary for overall sim info file</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">mesh_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;mesh_files&#39;</span><span class="p">]):</span> <span class="c1"># Loop for refinement levels</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                        <span class="n">refinement_level</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                        <span class="n">CLList</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                        <span class="n">CDList</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                        <span class="n">TList</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                        <span class="n">FList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Fail flag list</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                        <span class="n">refinement_level_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Creating refinement level sim info dictionary for overall sim info file</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                        <span class="c1"># Update Grid file</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                        <span class="n">aero_options</span><span class="p">[</span><span class="s1">&#39;gridFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;meshes_folder_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mesh_file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                        <span class="k">for</span> <span class="n">aoa</span> <span class="ow">in</span> <span class="n">aoa_list</span><span class="p">:</span> <span class="c1"># loop for angles of attack</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                            <span class="c1"># Date</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                            <span class="n">current_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                            <span class="n">date_string</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                            <span class="c1"># Define output directory -- Written to store in the parent directory</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                            <span class="n">output_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/exp_set_</span><span class="si">{</span><span class="n">exp_set</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refinement_level</span><span class="si">}</span><span class="s2">/aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                            <span class="n">aero_options</span><span class="p">[</span><span class="s1">&#39;outputDirectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dir</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                            <span class="c1"># name of the simulation info file at the aoa level directory</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                            <span class="n">aoa_info_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">.yaml&quot;</span> 
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                            <span class="n">aoa_level_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Creating aoa level sim info dictionary for overall sim info file</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                            <span class="c1">################################################################################</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                            <span class="c1"># OpenMDAO setup</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                            <span class="c1">################################################################################</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENMDAO_REPORTS&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="c1"># Do this to disable report generation by OpenMDAO</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                            <span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                            <span class="n">prob</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Top</span><span class="p">(</span><span class="n">case_info</span><span class="p">,</span> <span class="n">exp_info</span><span class="p">,</span> <span class="n">aero_options</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                            <span class="c1"># Checking for existing sucessful simualtion info, </span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aoa_info_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">aoa_file</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                                        <span class="n">aoa_sim_info</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">aoa_file</span><span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                                    <span class="n">fail_flag</span> <span class="o">=</span> <span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;fail_flag&#39;</span><span class="p">]</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                                    <span class="k">if</span> <span class="n">fail_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                                        <span class="n">CLList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cl&#39;</span><span class="p">])</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                                        <span class="n">CDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">])</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                                        <span class="n">TList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;wall_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; sec&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                                        <span class="n">FList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                                        <span class="c1"># To Store in the overall simulation out file in case of skipping</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                                        <span class="n">aoa_level_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                                            <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cl&#39;</span><span class="p">]),</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                                            <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]),</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                                            <span class="s1">&#39;wall_time&#39;</span><span class="p">:</span> <span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;wall_time&#39;</span><span class="p">],</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                                            <span class="s1">&#39;fail_flag&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">),</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                                            <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                                        <span class="p">}</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                                        <span class="n">refinement_level_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aoa_level_dict</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                                        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;NOTICE&#39;</span><span class="si">:</span><span class="s2">^50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping Angle of Attack (AoA): </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> | Reason: Existing successful simulation found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                                        <span class="k">continue</span> <span class="c1"># Continue to next loop if there exists a successful simulation</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                                <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                                    <span class="n">fail_flag</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                            <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span> <span class="c1"># Create the directory if it doesn&#39;t exist</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                                <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                            <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting Angle of Attack (AoA): </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                            <span class="c1"># Setup the problem</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                            <span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                            <span class="c1"># Set the angle</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                            <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;aoa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                            <span class="n">om</span><span class="o">.</span><span class="n">n2</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">show_browser</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mphys_aero.html&quot;</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                            <span class="c1"># Run the model</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                            <span class="n">aoa_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># Stote the start time</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                                <span class="n">prob</span><span class="o">.</span><span class="n">run_model</span><span class="p">()</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                                <span class="n">fail_flag</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                            <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                                <span class="n">fail_flag</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                            <span class="n">aoa_end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># Store the end time</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                            <span class="n">aoa_run_time</span> <span class="o">=</span> <span class="n">aoa_end_time</span> <span class="o">-</span> <span class="n">aoa_start_time</span> <span class="c1"># Compute the run time</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                            <span class="c1"># Store a Yaml file at this level</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                            <span class="n">aoa_out_dic</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                                <span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                                <span class="s1">&#39;exp_info&#39;</span><span class="p">:</span> <span class="n">exp_info</span><span class="p">,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                                <span class="s1">&#39;mesh_file_used&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;meshes_folder_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mesh_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                                <span class="s1">&#39;AOA&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">),</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                                <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cl&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                                <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cd&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                                <span class="s1">&#39;refinement_level&#39;</span><span class="p">:</span> <span class="n">refinement_level</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                                <span class="s1">&#39;wall_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aoa_run_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                                <span class="s1">&#39;fail_flag&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">),</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                                <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                            <span class="p">}</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aoa_info_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">interim_out_yaml</span><span class="p">:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">aoa_out_dic</span><span class="p">,</span> <span class="n">interim_out_yaml</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                            <span class="c1"># To Store in the overall simulation out file</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                            <span class="n">aoa_level_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                                <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cl&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                                <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cd&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                                <span class="s1">&#39;wall_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aoa_run_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                                <span class="s1">&#39;fail_flag&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">),</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                                <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                            <span class="p">}</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                            <span class="n">refinement_level_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aoa_level_dict</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                            <span class="c1"># Adding cl, cd, wall time, Fail flags to their respective lists to create the csv file at refinement level</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                            <span class="n">CLList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cl&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                            <span class="n">CDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cd&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                            <span class="n">TList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aoa_run_time</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                            <span class="n">FList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                        <span class="c1"># Write simulation results to a csv file</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                        <span class="n">refinement_level_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                            <span class="s2">&quot;Alpha&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">aoa_list</span><span class="p">],</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                            <span class="s2">&quot;CL&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cl</span><span class="si">:</span><span class="s2">8.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">CLList</span><span class="p">],</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                            <span class="s2">&quot;CD&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cd</span><span class="si">:</span><span class="s2">8.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cd</span> <span class="ow">in</span> <span class="n">CDList</span><span class="p">],</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                            <span class="s2">&quot;FFlag&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">FF</span><span class="p">)</span><span class="si">:</span><span class="s2">12f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">FF</span> <span class="ow">in</span> <span class="n">FList</span><span class="p">],</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                            <span class="s2">&quot;WTime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wall_time</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">wall_time</span> <span class="ow">in</span> <span class="n">TList</span><span class="p">]</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                        <span class="p">}</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">refinement_level_data</span><span class="p">)</span> <span class="c1"># Create a panda DataFrame</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                        <span class="c1"># Define the output file path</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                        <span class="n">refinement_level_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                        <span class="n">ADflow_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refinement_level_dir</span><span class="si">}</span><span class="s2">/ADflow_output.csv&quot;</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                        <span class="c1"># Write the DataFrame to a CSV file</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">ADflow_out_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                        <span class="c1"># Add csv file location to the overall simulation out file</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                        <span class="n">refinement_level_dict</span><span class="p">[</span><span class="s1">&#39;csv_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ADflow_out_file</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                        <span class="n">refinement_level_dict</span><span class="p">[</span><span class="s1">&#39;refinement_out_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refinement_level_dir</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                        <span class="c1"># Add refinement level dict to exp level dict</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                        <span class="n">exp_sim_info</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refinement_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refinement_level_dict</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                    <span class="c1"># Add experimental level simulation to the overall simulation out file</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                    <span class="n">exp_out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">refinement_level_dir</span><span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                    <span class="n">exp_sim_info</span><span class="p">[</span><span class="s1">&#39;exp_set_out_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_out_dir</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                    <span class="n">sim_out_info</span><span class="p">[</span><span class="s1">&#39;hierarchies&#39;</span><span class="p">][</span><span class="n">hierarchy</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">][</span><span class="n">case</span><span class="p">][</span><span class="s1">&#39;exp_sets&#39;</span><span class="p">][</span><span class="n">exp_set</span><span class="p">][</span><span class="s1">&#39;sim_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_sim_info</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="n">end_wall_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">net_run_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="n">sim_out_info</span><span class="p">[</span><span class="s1">&#39;overall_sim_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">start_wall_time</span><span class="p">,</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="s1">&#39;end_time&#39;</span><span class="p">:</span> <span class="n">end_wall_time</span><span class="p">,</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="s1">&#39;total_wall_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">net_run_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="p">}</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="c1"># Store the final simulation out file.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_out_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">final_out_yaml_handle</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sim_out_info</span><span class="p">,</span> <span class="n">final_out_yaml_handle</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="n">comm</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="c1">################################################################################</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="c1"># Code for user to run simulations</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="c1">################################################################################</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        Executes the simulation on either a local machine or an HPC system.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        This method checks the simulation settings from the input YAML file. Based on the `hpc` flag, it either runs the simulation locally or generates an HPC job script for execution.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        -----</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        - For local execution (`hpc: no`), it directly calls `run_problem()`.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        - For HPC execution (`hpc: yes`), it creates a Python file and a job script, then submits the job using `sbatch`.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="n">sim_info_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="k">if</span> <span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hpc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_problem</span><span class="p">()</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">elif</span> <span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hpc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">python_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/run_sim.py&quot;</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">slrum_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;overall_sim_out.txt&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="c1"># Create a python file to run</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="n">write_python_file</span><span class="p">(</span><span class="n">python_file_path</span><span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="c1"># Create a job script to run</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">job_script_path</span> <span class="o">=</span> <span class="n">write_job_script</span><span class="p">(</span><span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hpc_info&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">slrum_out_file</span><span class="p">,</span> <span class="n">python_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_file</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;sbatch&quot;</span><span class="p">,</span> <span class="n">job_script_path</span><span class="p">])</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="c1">################################################################################</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="c1"># Code for Post Processing</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="c1">################################################################################</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">        Generates plots comparing experimental data with ADflow simulation results.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        This method creates comparison plots for each experimental condition and refinement level. The plots include `CL` (Lift Coefficient) and `CD` (Drag Coefficient) against the angle of attack (Alpha). Experimental data, if provided, is included in the plots for validation.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        Outputs</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        -------</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        - *PNG plots*:</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">            Stored in the experimental condition directory for each hierarchy and case.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        Notes</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        -----</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        - Experimental data is optional. If not provided, only simulation results are plotted.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">        - Plots are saved with clear labels and legends for easy interpretation.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="n">sim_out_info</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_out_file</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">for</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">hierarchy_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_out_info</span><span class="p">[</span><span class="s1">&#39;hierarchies&#39;</span><span class="p">]):</span> <span class="c1"># loop for Hierarchy level</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="k">for</span> <span class="n">case</span><span class="p">,</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;cases&#39;</span><span class="p">]):</span> <span class="c1"># loop for cases in hierarchy</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="k">for</span> <span class="n">exp_set</span><span class="p">,</span> <span class="n">exp_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;exp_sets&#39;</span><span class="p">]):</span> <span class="c1"># loop for experimental datasets that may present</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                    <span class="c1"># Plot setup</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comparison between ADflow Simulation and Experimental Data&#39;</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="c1"># Load Experimental Data</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                        <span class="n">exp_cl_data</span> <span class="o">=</span> <span class="n">load_csv_data</span><span class="p">(</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;exp_data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                        <span class="n">exp_cd_data</span> <span class="o">=</span> <span class="n">load_csv_data</span><span class="p">(</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;exp_data&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                        <span class="n">exp_cl_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                        <span class="n">exp_cd_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Experimental data location is not specified or the data is not readable. Continuing to plot without experimental data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                    <span class="k">if</span> <span class="n">exp_cl_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exp_cd_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Only plot if data loaded successfully</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_cl_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">exp_cl_data</span><span class="p">[</span><span class="s1">&#39;CL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_cd_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">exp_cd_data</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                    <span class="c1"># Load Simulated Data</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                    <span class="n">exp_out_dir</span> <span class="o">=</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;sim_info&#39;</span><span class="p">][</span><span class="s1">&#39;exp_set_out_dir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                    <span class="n">sim_data</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">mesh_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;mesh_files&#39;</span><span class="p">]):</span> <span class="c1"># Loop for refinement levels</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                        <span class="n">refinement_level_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp_out_dir</span><span class="si">}</span><span class="s2">/L</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                        <span class="n">ADflow_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refinement_level_dir</span><span class="si">}</span><span class="s2">/ADflow_output.csv&quot;</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                        <span class="n">sim_data</span> <span class="o">=</span> <span class="n">load_csv_data</span><span class="p">(</span><span class="n">ADflow_out_file</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                        <span class="k">if</span> <span class="n">sim_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Only plot if data loaded successfully</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;CL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="c1"># Plot CL vs Alpha for this refinement level</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="c1"># Plot CD vs Alpha for this refinement level</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                    <span class="c1"># Setting titles, labels, and legends</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CL vs Alpha&#39;</span><span class="p">)</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha (deg)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CL&#39;</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CD vs Alpha&#39;</span><span class="p">)</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha (deg)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CD&#39;</span><span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">])</span>  <span class="c1"># Adjust layout to fit title</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp_out_dir</span><span class="si">}</span><span class="s2">/ADflow_Results.png&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="run_sim.run_sim.post_process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">post_process</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates plots comparing experimental data with ADflow simulation results.</p>
<p>This method creates comparison plots for each experimental condition and refinement level. The plots include <code>CL</code> (Lift Coefficient) and <code>CD</code> (Drag Coefficient) against the angle of attack (Alpha). Experimental data, if provided, is included in the plots for validation.</p>
<h5 id="run_sim.run_sim.post_process--outputs">Outputs</h5>
<ul>
<li><em>PNG plots</em>:
    Stored in the experimental condition directory for each hierarchy and case.</li>
</ul>
<h5 id="run_sim.run_sim.post_process--notes">Notes</h5>
<ul>
<li>Experimental data is optional. If not provided, only simulation results are plotted.</li>
<li>Plots are saved with clear labels and legends for easy interpretation.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>simulateTestCases/run_sim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    Generates plots comparing experimental data with ADflow simulation results.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    This method creates comparison plots for each experimental condition and refinement level. The plots include `CL` (Lift Coefficient) and `CD` (Drag Coefficient) against the angle of attack (Alpha). Experimental data, if provided, is included in the plots for validation.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    Outputs</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    -------</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    - *PNG plots*:</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        Stored in the experimental condition directory for each hierarchy and case.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">    -----</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    - Experimental data is optional. If not provided, only simulation results are plotted.</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    - Plots are saved with clear labels and legends for easy interpretation.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="n">sim_out_info</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_out_file</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="k">for</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">hierarchy_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_out_info</span><span class="p">[</span><span class="s1">&#39;hierarchies&#39;</span><span class="p">]):</span> <span class="c1"># loop for Hierarchy level</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="k">for</span> <span class="n">case</span><span class="p">,</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;cases&#39;</span><span class="p">]):</span> <span class="c1"># loop for cases in hierarchy</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="k">for</span> <span class="n">exp_set</span><span class="p">,</span> <span class="n">exp_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;exp_sets&#39;</span><span class="p">]):</span> <span class="c1"># loop for experimental datasets that may present</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                <span class="c1"># Plot setup</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comparison between ADflow Simulation and Experimental Data&#39;</span><span class="p">)</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="c1"># Load Experimental Data</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                    <span class="n">exp_cl_data</span> <span class="o">=</span> <span class="n">load_csv_data</span><span class="p">(</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;exp_data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                    <span class="n">exp_cd_data</span> <span class="o">=</span> <span class="n">load_csv_data</span><span class="p">(</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;exp_data&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                    <span class="n">exp_cl_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                    <span class="n">exp_cd_data</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Experimental data location is not specified or the data is not readable. Continuing to plot without experimental data&quot;</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                <span class="k">if</span> <span class="n">exp_cl_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exp_cd_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Only plot if data loaded successfully</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_cl_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">exp_cl_data</span><span class="p">[</span><span class="s1">&#39;CL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_cd_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">exp_cd_data</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experimental&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                <span class="c1"># Load Simulated Data</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="n">exp_out_dir</span> <span class="o">=</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;sim_info&#39;</span><span class="p">][</span><span class="s1">&#39;exp_set_out_dir&#39;</span><span class="p">]</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="n">sim_data</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">mesh_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;mesh_files&#39;</span><span class="p">]):</span> <span class="c1"># Loop for refinement levels</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                    <span class="n">refinement_level_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp_out_dir</span><span class="si">}</span><span class="s2">/L</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                    <span class="n">ADflow_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refinement_level_dir</span><span class="si">}</span><span class="s2">/ADflow_output.csv&quot;</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                    <span class="n">sim_data</span> <span class="o">=</span> <span class="n">load_csv_data</span><span class="p">(</span><span class="n">ADflow_out_file</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                    <span class="k">if</span> <span class="n">sim_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Only plot if data loaded successfully</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;CL&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="c1"># Plot CL vs Alpha for this refinement level</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;Alpha&#39;</span><span class="p">],</span> <span class="n">sim_data</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span> <span class="c1"># Plot CD vs Alpha for this refinement level</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                <span class="c1"># Setting titles, labels, and legends</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CL vs Alpha&#39;</span><span class="p">)</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha (deg)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CL&#39;</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CD vs Alpha&#39;</span><span class="p">)</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Alpha (deg)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CD&#39;</span><span class="p">)</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">])</span>  <span class="c1"># Adjust layout to fit title</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp_out_dir</span><span class="si">}</span><span class="s2">/ADflow_Results.png&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="run_sim.run_sim.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Executes the simulation on either a local machine or an HPC system.</p>
<p>This method checks the simulation settings from the input YAML file. Based on the <code>hpc</code> flag, it either runs the simulation locally or generates an HPC job script for execution.</p>
<h5 id="run_sim.run_sim.run--notes">Notes</h5>
<ul>
<li>For local execution (<code>hpc: no</code>), it directly calls <code>run_problem()</code>.</li>
<li>For HPC execution (<code>hpc: yes</code>), it creates a Python file and a job script, then submits the job using <code>sbatch</code>.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>simulateTestCases/run_sim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    Executes the simulation on either a local machine or an HPC system.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    This method checks the simulation settings from the input YAML file. Based on the `hpc` flag, it either runs the simulation locally or generates an HPC job script for execution.</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">    -----</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    - For local execution (`hpc: no`), it directly calls `run_problem()`.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    - For HPC execution (`hpc: yes`), it creates a Python file and a job script, then submits the job using `sbatch`.</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="n">sim_info_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="k">if</span> <span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hpc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_problem</span><span class="p">()</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="k">elif</span> <span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hpc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="n">python_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/run_sim.py&quot;</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="n">slrum_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;overall_sim_out.txt&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="c1"># Create a python file to run</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">write_python_file</span><span class="p">(</span><span class="n">python_file_path</span><span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="c1"># Create a job script to run</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">job_script_path</span> <span class="o">=</span> <span class="n">write_job_script</span><span class="p">(</span><span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hpc_info&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">slrum_out_file</span><span class="p">,</span> <span class="n">python_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_file</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;sbatch&quot;</span><span class="p">,</span> <span class="n">job_script_path</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="run_sim.run_sim.run_problem" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_problem</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets up and runs the OpenMDAO problem for aerodynamic simulations.</p>
<p>This method iterates through all hierarchies, cases, refinement levels, and angles of attack defined in the input YAML file. For each combination, it sets up the OpenMDAO problem, runs the simulation, and stores the results.</p>
<h5 id="run_sim.run_sim.run_problem--outputs">Outputs</h5>
<ul>
<li><strong>A CSV file</strong>:
    Contains results for each angle of attack at the current refinement level.</li>
<li><strong>A YAML file</strong>:
    Stores simulation data for each angle of attack in the corresponding directory.</li>
<li><strong>A final YAML file</strong>:
    Summarizes all simulation results across hierarchies, cases, and refinement levels.</li>
</ul>
<h5 id="run_sim.run_sim.run_problem--notes">Notes</h5>
<p>This method ensures that:</p>
<ul>
<li>Existing successful simulations are skipped.</li>
<li>Directories are created dynamically if they do not exist.</li>
<li>Simulation results are saved in structured output files.</li>
</ul>

            <details class="quote">
              <summary>Source code in <code>simulateTestCases/run_sim.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="k">def</span> <span class="nf">run_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Sets up and runs the OpenMDAO problem for aerodynamic simulations.</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    This method iterates through all hierarchies, cases, refinement levels, and angles of attack defined in the input YAML file. For each combination, it sets up the OpenMDAO problem, runs the simulation, and stores the results.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    Outputs</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    -------</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    - **A CSV file**:</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        Contains results for each angle of attack at the current refinement level.</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    - **A YAML file**:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        Stores simulation data for each angle of attack in the corresponding directory.</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    - **A final YAML file**:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        Summarizes all simulation results across hierarchies, cases, and refinement levels.</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    Notes</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    -----</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    This method ensures that:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    - Existing successful simulations are skipped.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    - Directories are created dynamically if they do not exist.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    - Simulation results are saved in structured output files.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="c1"># Store a copy of input YAML file in output directory</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="n">input_yaml_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/input_file.yaml&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_yaml_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_yaml_handle</span><span class="p">:</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">,</span> <span class="n">input_yaml_handle</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">sim_info_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">)</span> <span class="c1"># Copying to run the loop</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">sim_out_info</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_info</span><span class="p">)</span> <span class="c1"># Copying to write the output YAML file</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">start_wall_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">for</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">hierarchy_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_info_copy</span><span class="p">[</span><span class="s1">&#39;hierarchies&#39;</span><span class="p">]):</span> <span class="c1"># loop for Hierarchy level</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">for</span> <span class="n">case</span><span class="p">,</span> <span class="n">case_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;cases&#39;</span><span class="p">]):</span> <span class="c1"># loop for cases in hierarchy</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="n">aero_options</span> <span class="o">=</span> <span class="n">default_aero_options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">aero_options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;solver_parameters&#39;</span><span class="p">])</span> <span class="c1"># Update ADflow solver parameters</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="k">for</span> <span class="n">exp_set</span><span class="p">,</span> <span class="n">exp_info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;exp_sets&#39;</span><span class="p">]):</span> <span class="c1"># loop for experimental datasets that may present</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;SIMULATION INFO&#39;</span><span class="si">:</span><span class="s2">^30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Hierarchy&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Case Name&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Experimental Condition&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exp_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Reynolds Number (Re)&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;Re&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Mach Number&#39;</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;mach&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="c1"># Extract the Angle of attacks for which the simulation has to be run</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="n">aoa_list</span> <span class="o">=</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;aoa_list&#39;</span><span class="p">]</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="n">exp_sim_info</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Creating experimental level sim info dictionary for overall sim info file</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">mesh_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;mesh_files&#39;</span><span class="p">]):</span> <span class="c1"># Loop for refinement levels</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                    <span class="n">refinement_level</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                    <span class="n">CLList</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                    <span class="n">CDList</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                    <span class="n">TList</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                    <span class="n">FList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Fail flag list</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>                    <span class="n">refinement_level_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Creating refinement level sim info dictionary for overall sim info file</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                    <span class="c1"># Update Grid file</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                    <span class="n">aero_options</span><span class="p">[</span><span class="s1">&#39;gridFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;meshes_folder_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mesh_file</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                    <span class="k">for</span> <span class="n">aoa</span> <span class="ow">in</span> <span class="n">aoa_list</span><span class="p">:</span> <span class="c1"># loop for angles of attack</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                        <span class="c1"># Date</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                        <span class="n">current_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>                        <span class="n">date_string</span> <span class="o">=</span> <span class="n">current_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                        <span class="c1"># Define output directory -- Written to store in the parent directory</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                        <span class="n">output_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">hierarchy_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/exp_set_</span><span class="si">{</span><span class="n">exp_set</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">refinement_level</span><span class="si">}</span><span class="s2">/aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>                        <span class="n">aero_options</span><span class="p">[</span><span class="s1">&#39;outputDirectory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dir</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>                        <span class="c1"># name of the simulation info file at the aoa level directory</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                        <span class="n">aoa_info_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">.yaml&quot;</span> 
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                        <span class="n">aoa_level_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Creating aoa level sim info dictionary for overall sim info file</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                        <span class="c1">################################################################################</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>                        <span class="c1"># OpenMDAO setup</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                        <span class="c1">################################################################################</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENMDAO_REPORTS&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="c1"># Do this to disable report generation by OpenMDAO</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                        <span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                        <span class="n">prob</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Top</span><span class="p">(</span><span class="n">case_info</span><span class="p">,</span> <span class="n">exp_info</span><span class="p">,</span> <span class="n">aero_options</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>                        <span class="c1"># Checking for existing sucessful simualtion info, </span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aoa_info_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">aoa_file</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                                    <span class="n">aoa_sim_info</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">aoa_file</span><span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                                <span class="n">fail_flag</span> <span class="o">=</span> <span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;fail_flag&#39;</span><span class="p">]</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                                <span class="k">if</span> <span class="n">fail_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                                    <span class="n">CLList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cl&#39;</span><span class="p">])</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                                    <span class="n">CDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">])</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                                    <span class="n">TList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;wall_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; sec&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                                    <span class="n">FList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">)</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                                    <span class="c1"># To Store in the overall simulation out file in case of skipping</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>                                    <span class="n">aoa_level_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                                        <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cl&#39;</span><span class="p">]),</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                                        <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]),</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                                        <span class="s1">&#39;wall_time&#39;</span><span class="p">:</span> <span class="n">aoa_sim_info</span><span class="p">[</span><span class="s1">&#39;wall_time&#39;</span><span class="p">],</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                                        <span class="s1">&#39;fail_flag&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">),</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                                        <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>                                    <span class="p">}</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                                    <span class="n">refinement_level_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aoa_level_dict</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                                    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;NOTICE&#39;</span><span class="si">:</span><span class="s2">^50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping Angle of Attack (AoA): </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2"> | Reason: Existing successful simulation found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>                                    <span class="k">continue</span> <span class="c1"># Continue to next loop if there exists a successful simulation</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                            <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                                <span class="n">fail_flag</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span> <span class="c1"># Create the directory if it doesn&#39;t exist</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                            <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                        <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting Angle of Attack (AoA): </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                        <span class="c1"># Setup the problem</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                        <span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                        <span class="c1"># Set the angle</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                        <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;aoa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>                        <span class="n">om</span><span class="o">.</span><span class="n">n2</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">show_browser</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mphys_aero.html&quot;</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                        <span class="c1"># Run the model</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                        <span class="n">aoa_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># Stote the start time</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                            <span class="n">prob</span><span class="o">.</span><span class="n">run_model</span><span class="p">()</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>                            <span class="n">fail_flag</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>                            <span class="n">fail_flag</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                        <span class="n">aoa_end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># Store the end time</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                        <span class="n">aoa_run_time</span> <span class="o">=</span> <span class="n">aoa_end_time</span> <span class="o">-</span> <span class="n">aoa_start_time</span> <span class="c1"># Compute the run time</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list_inputs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list_outputs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                        <span class="c1"># Store a Yaml file at this level</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                        <span class="n">aoa_out_dic</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                            <span class="s1">&#39;case&#39;</span><span class="p">:</span> <span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                            <span class="s1">&#39;exp_info&#39;</span><span class="p">:</span> <span class="n">exp_info</span><span class="p">,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                            <span class="s1">&#39;mesh_file_used&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case_info</span><span class="p">[</span><span class="s1">&#39;meshes_folder_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mesh_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                            <span class="s1">&#39;AOA&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">aoa</span><span class="p">),</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                            <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cl&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>                            <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cd&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                            <span class="s1">&#39;refinement_level&#39;</span><span class="p">:</span> <span class="n">refinement_level</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                            <span class="s1">&#39;wall_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aoa_run_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                            <span class="s1">&#39;fail_flag&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">),</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                            <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                        <span class="p">}</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aoa_info_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">interim_out_yaml</span><span class="p">:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">aoa_out_dic</span><span class="p">,</span> <span class="n">interim_out_yaml</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                        <span class="c1"># To Store in the overall simulation out file</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                        <span class="n">aoa_level_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                            <span class="s1">&#39;cl&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cl&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                            <span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cd&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                            <span class="s1">&#39;wall_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aoa_run_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                            <span class="s1">&#39;fail_flag&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">),</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                            <span class="s1">&#39;out_dir&#39;</span><span class="p">:</span> <span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                        <span class="p">}</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                        <span class="n">refinement_level_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;aoa_</span><span class="si">{</span><span class="n">aoa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aoa_level_dict</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                        <span class="c1"># Adding cl, cd, wall time, Fail flags to their respective lists to create the csv file at refinement level</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                        <span class="n">CLList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cl&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                        <span class="n">CDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.aero_post.cd&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                        <span class="n">TList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aoa_run_time</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                        <span class="n">FList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fail_flag</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                    <span class="c1"># Write simulation results to a csv file</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                    <span class="n">refinement_level_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                        <span class="s2">&quot;Alpha&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alpha</span><span class="si">:</span><span class="s2">6.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">aoa_list</span><span class="p">],</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                        <span class="s2">&quot;CL&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cl</span><span class="si">:</span><span class="s2">8.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">CLList</span><span class="p">],</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                        <span class="s2">&quot;CD&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cd</span><span class="si">:</span><span class="s2">8.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cd</span> <span class="ow">in</span> <span class="n">CDList</span><span class="p">],</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                        <span class="s2">&quot;FFlag&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">FF</span><span class="p">)</span><span class="si">:</span><span class="s2">12f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">FF</span> <span class="ow">in</span> <span class="n">FList</span><span class="p">],</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                        <span class="s2">&quot;WTime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wall_time</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">wall_time</span> <span class="ow">in</span> <span class="n">TList</span><span class="p">]</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                    <span class="p">}</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">refinement_level_data</span><span class="p">)</span> <span class="c1"># Create a panda DataFrame</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>                    <span class="c1"># Define the output file path</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                    <span class="n">refinement_level_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                    <span class="n">ADflow_out_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refinement_level_dir</span><span class="si">}</span><span class="s2">/ADflow_output.csv&quot;</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                    <span class="c1"># Write the DataFrame to a CSV file</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">ADflow_out_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                    <span class="c1"># Add csv file location to the overall simulation out file</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                    <span class="n">refinement_level_dict</span><span class="p">[</span><span class="s1">&#39;csv_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ADflow_out_file</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>                    <span class="n">refinement_level_dict</span><span class="p">[</span><span class="s1">&#39;refinement_out_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refinement_level_dir</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>                    <span class="c1"># Add refinement level dict to exp level dict</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>                    <span class="n">exp_sim_info</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refinement_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refinement_level_dict</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="c1"># Add experimental level simulation to the overall simulation out file</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="n">exp_out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">refinement_level_dir</span><span class="p">)</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                <span class="n">exp_sim_info</span><span class="p">[</span><span class="s1">&#39;exp_set_out_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_out_dir</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="n">sim_out_info</span><span class="p">[</span><span class="s1">&#39;hierarchies&#39;</span><span class="p">][</span><span class="n">hierarchy</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">][</span><span class="n">case</span><span class="p">][</span><span class="s1">&#39;exp_sets&#39;</span><span class="p">][</span><span class="n">exp_set</span><span class="p">][</span><span class="s1">&#39;sim_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp_sim_info</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">end_wall_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="n">net_run_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="n">sim_out_info</span><span class="p">[</span><span class="s1">&#39;overall_sim_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">start_wall_time</span><span class="p">,</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="s1">&#39;end_time&#39;</span><span class="p">:</span> <span class="n">end_wall_time</span><span class="p">,</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="s1">&#39;total_wall_time&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">net_run_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> sec&quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="p">}</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="c1"># Store the final simulation out file.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="k">if</span> <span class="n">comm</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_out_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">final_out_yaml_handle</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sim_out_info</span><span class="p">,</span> <span class="n">final_out_yaml_handle</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="n">comm</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>